<!DOCTYPE html>
<html>
<head>
    <title>Highcharts CSV Dynamic Update</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
</head>
<body>

<!-- Dropdown menu to select CSV files -->
<label for="csvSelect">Choose a dataset:</label>
<select id="csvSelect">
    <option value="https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/data/Klimaendringene%20har%20ingen%20negative%20konsekvenser.csv">Dataset 1: Klimaendringene har ingen negative konsekvenser</option>
    <option value="https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/data/I%20hvilken%20grad%20bekymrer%20du%20deg%20for%20tap%20av%20natur.csv">Dataset 2: I hvilken grad bekymrer du deg for tap av natur</option>
    <!-- Add more options as needed -->
</select>

<div id="container" style="width:100%; height:400px;"></div>

<script>
// Function to load and render a chart based on the selected CSV
function renderChart(csvURL) {
    const fileName = decodeURIComponent(csvURL.split('/').pop().replace('.csv', ''));

    fetch('https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/json/chart-styles.json')  // Update this path to your JSON file
        .then(response => response.json())
        .then(styleConfig => {
            // Set the chart title dynamically based on the selected CSV file name
            styleConfig.title.text = `${fileName}`;

            // Add the data loading configuration to the styleConfig
            styleConfig.data = {
                csvURL: csvURL,  // Use the selected CSV URL
                enablePolling: true,
                dataRefreshRate: 60 // Refresh every 60 seconds
            };

            // Initialize the Highcharts chart with the combined configuration
            Highcharts.chart('container', styleConfig);
        })
        .catch(error => console.error('Error loading style config:', error));
}

// Event listener for dropdown menu change
document.getElementById('csvSelect').addEventListener('change', function () {
    const selectedCSV = this.value;
    renderChart(selectedCSV);  // Render the chart with the selected CSV
});

// Initial chart rendering with the first CSV option
document.addEventListener('DOMContentLoaded', function () {
    const initialCSV = document.getElementById('csvSelect').value;
    renderChart(initialCSV);  // Render the chart with the first CSV on page load
});
</script>

</body>
</html>
