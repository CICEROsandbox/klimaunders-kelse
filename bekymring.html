<!DOCTYPE html>
<html>
<head>
    <title>Highcharts CSV Dynamic Update</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
</head>
<body>

<div id="container" style="width:100%; height:400px;"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    Highcharts.chart('container', {
        title: {
            text: 'I hvilken grad bekymrer du deg for klimaendringer?',
            style: {
                fontFamily: 'Averta',
                color: '#000000',
                fontSize: '20px',
                fontWeight: 'bold'
            },
            align: 'left'
        },
        xAxis: {
            title: {
                text: 'Year'
            },
            categories: [] // Will be dynamically filled
        },
        yAxis: {
            title: {
                text: 'Prosent'
            },
            max: 100,
            minRange: 70
        },
        series: [], // Will be dynamically filled
        data: {
            csvURL: 'https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/bekymring-test.csv', // Your CSV URL
            enablePolling: true,
            dataRefreshRate: 60,
            parsed: function (columns) {
                var categories = [];
                var seriesData = [
                    { name: 'Ikke bekymret i det hele tatt', data: [] },
                    { name: 'Litt bekymret', data: [] },
                    { name: 'Ganske bekymret', data: [] },
                    { name: 'Veldig bekymret', data: [] },
                    { name: 'Vet ikke', data: [] }
                ];

                // Loop through the CSV rows (columns[i]) and assign categories/years and series data
                for (var i = 1; i < columns.length; i++) { // Starting from 1 to skip header row
                    categories.push(columns[i][0]); // First column is the category (year)
                    seriesData[0].data.push(parseFloat(columns[i][1])); // "Ikke bekymret i det hele tatt"
                    seriesData[1].data.push(parseFloat(columns[i][2])); // "Litt bekymret"
                    seriesData[2].data.push(parseFloat(columns[i][3])); // "Ganske bekymret"
                    seriesData[3].data.push(parseFloat(columns[i][4])); // "Veldig bekymret"
                    seriesData[4].data.push(parseFloat(columns[i][5])); // "Vet ikke"
                }

                // Apply categories (years) and series data to the chart
                this.xAxis[0].setCategories(categories);
                for (var j = 0; j < seriesData.length; j++) {
                    this.addSeries(seriesData[j], false);
                }
                this.redraw();
            }
        },
        credits: {
            href: '',
            text: 'N= 18:4046 19:4011 20:3986 21:4879 22:3969 23:4125, CICEROs klimaundersÃ¸kelse'
        },
        legend: {
            itemStyle: {
                fontSize: '14px',
                fontFamily: 'Averta'
            }
        },
        plotOptions: {
            series: {
                animation: false
            }
        }
    });
});
</script>

</body>
</html>
