<script>
document.addEventListener('DOMContentLoaded', function () {
    Highcharts.chart('container', {
        title: {
            text: 'I hvilken grad bekymrer du deg for klimaendringer?',
            style: {
                fontFamily: 'Averta',
                color: '#000000',
                fontSize: '20px',
                fontWeight: 'bold'
            },
            align: 'left'
        },
        xAxis: {
            title: {
                text: 'Year'
            },
            categories: [] // Years will be dynamically added
        },
        yAxis: {
            title: {
                text: 'Prosent'
            },
            max: 100,
            minRange: 70
        },
        series: [], // Series will be dynamically added
        data: {
            csvURL: 'https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/bekymring-test.csv', // Your CSV file URL
            enablePolling: true,
            dataRefreshRate: 60,
            parsed: function (columns) {
                var categories = columns[0].slice(1); // Use the first column for categories (years)
                var seriesNames = columns[1]; // Series names are in the first row of data

                // Initialize series
                var series = [
                    { name: 'Ikke bekymret i det hele tatt', data: [] },
                    { name: 'Litt bekymret', data: [] },
                    { name: 'Ganske bekymret', data: [] },
                    { name: 'Veldig bekymret', data: [] },
                    { name: 'Vet ikke', data: [] }
                ];

                // Loop through the rows and assign the data to the correct series
                for (var i = 1; i < columns.length; i++) {
                    for (var j = 1; j <= 5; j++) {
                        series[j - 1].data.push(parseFloat(columns[i][j]));
                    }
                }

                // Set categories (years) and series in the chart
                this.xAxis[0].setCategories(categories);
                for (var k = 0; k < series.length; k++) {
                    this.addSeries(series[k], false);
                }

                this.redraw(); // Redraw the chart with the new data
            }
        },
        credits: {
            href: '',
            text: 'N= 18:4046 19:4011 20:3986 21:4879 22:3969 23:4125, CICEROs klimaundersÃ¸kelse'
        },
        legend: {
            itemStyle: {
                fontSize: '14px',
                fontFamily: 'Averta'
            }
        },
        plotOptions: {
            series: {
                animation: false
            }
        }
    });
});
</script>
