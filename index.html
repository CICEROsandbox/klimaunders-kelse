<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Highcharts Visualization</title>
    <!-- Include Highcharts Library -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <!-- Include Highcharts CSV Module -->
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <!-- (Optional) Include Highcharts Exporting Module -->
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <style>
        /* Optional: Style your chart container */
        #container {
            width: 80%;
            height: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>

    <div id="container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Function to fetch JSON configuration
            fetch('https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(config => {
                    // Initialize Highcharts after fetching JSON
                    Highcharts.chart('container', {
                        title: {
                            text: config.title,
                            style: {
                                fontFamily: 'Arial',
                                color: '#000000',
                                fontSize: '20px',
                                fontWeight: 'bold'
                            },
                            align: 'left'
                        },
                        subtitle: {
                            text: config.subtitle
                        },
                        xAxis: {
                            title: {
                                text: config.xAxisTitle
                            }
                        },
                        yAxis: {
                            title: {
                                text: config.yAxisTitle
                            },
                            max: 100,
                            min: 0
                        },
                        series: [], // Will be populated from CSV
                        data: {
                            csvURL: 'https://raw.githubusercontent.com/CICEROsandbox/klimaundersokelse/main/data.csv', // Path to your CSV file
                            enablePolling: false, // Set to true if you want to poll for updates
                            dataRefreshRate: 60, // Refresh rate in seconds
                            enableCSV: true,
                            enableJSON: false,
                            // Define delimiter based on your CSV (comma in this case)
                            delimiter: ';',
                            parsed: function (columns) {
                                // Log columns for debugging
                                console.log('Parsed Columns:', columns);

                                // Assuming first row is header
                                var categories = [];
                                var seriesData = [];

                                // Extract headers (skip the first column if it's categories)
                                var headers = columns[0].map(header => header.trim());
                                console.log('Headers:', headers);

                                // Initialize series based on headers (excluding the first column)
                                for (var i = 1; i < headers.length; i++) {
                                    seriesData.push({
                                        name: headers[i],
                                        data: []
                                    });
                                }

                                // Populate categories and series data
                                for (var i = 1; i < columns.length; i++) {
                                    categories.push(columns[i][0]); // First column as categories (e.g., Year)
                                    for (var j = 1; j < columns[i].length; j++) {
                                        var value = parseFloat(columns[i][j]);
                                        // Handle NaN values
                                        value = isNaN(value) ? 0 : value;
                                        seriesData[j - 1].data.push(value);
                                    }
                                }

                                console.log('Categories:', categories);
                                console.log('Series Data:', seriesData);

                                // Update chart categories
                                this.xAxis[0].setCategories(categories);

                                // Add series to chart
                                for (var i = 0; i < seriesData.length; i++) {
                                    this.addSeries(seriesData[i], false);
                                }

                                // Redraw chart after adding all series
                                this.redraw();
                            }
                        },
                        credits: {
                            href: '',
                            text: config.creditsText
                        },
                        legend: {
                            itemStyle: {
                                fontSize: '14px',
                                fontFamily: 'Arial'
                            }
                        },
                        plotOptions: {
                            series: {
                                animation: false
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error fetching JSON configuration:', error);
                });
        });
    </script>

</body>
</html>
